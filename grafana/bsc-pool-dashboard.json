{
  "dashboard": {
    "id": null,
    "uid": "bsc-pool-monitor",
    "title": "BSC USDT/BTCB Pool Analytics",
    "description": "Comprehensive monitoring for PancakeSwap USDT/BTCB 0.05% pool",
    "tags": ["bsc", "pancakeswap", "liquidity", "mm-tracking"],
    "timezone": "browser",
    "schemaVersion": 30,
    "version": 1,
    "refresh": "10s",
    "time": {
      "from": "now-24h",
      "to": "now"
    },
    "annotations": {
      "list": [
        {
          "datasource": "PostgreSQL",
          "enable": true,
          "name": "Alerts",
          "rawQuery": "SELECT timestamp as time, alert_type as text, description, severity FROM manipulation_alerts WHERE timestamp > $__timeFrom()",
          "showIn": 0
        }
      ]
    },
    "panels": [
      {
        "id": 1,
        "gridPos": {"h": 5, "w": 6, "x": 0, "y": 0},
        "type": "stat",
        "title": "Total Value Locked (TVL)",
        "description": "Total capital locked in the pool",
        "targets": [
          {
            "datasource": "PostgreSQL",
            "rawSql": "SELECT tvl FROM bsc_pool_metrics ORDER BY timestamp DESC LIMIT 1",
            "format": "table"
          }
        ],
        "fieldConfig": {
          "defaults": {
            "unit": "currencyUSD",
            "decimals": 0,
            "thresholds": {
              "mode": "absolute",
              "steps": [
                {"color": "red", "value": 0},
                {"color": "yellow", "value": 100000},
                {"color": "green", "value": 1000000}
              ]
            }
          }
        }
      },
      {
        "id": 2,
        "gridPos": {"h": 5, "w": 6, "x": 6, "y": 0},
        "type": "stat",
        "title": "Pool Balance Ratio",
        "description": "BTCB/USDT value ratio (ideal: 50%)",
        "targets": [
          {
            "datasource": "PostgreSQL",
            "rawSql": "SELECT pool_ratio * 100 as value FROM bsc_pool_metrics ORDER BY timestamp DESC LIMIT 1",
            "format": "table"
          }
        ],
        "fieldConfig": {
          "defaults": {
            "unit": "percent",
            "decimals": 2,
            "thresholds": {
              "mode": "absolute",
              "steps": [
                {"color": "red", "value": 0},
                {"color": "yellow", "value": 40},
                {"color": "green", "value": 45},
                {"color": "yellow", "value": 55},
                {"color": "red", "value": 60}
              ]
            },
            "min": 0,
            "max": 100
          }
        },
        "options": {
          "graphMode": "area"
        }
      },
      {
        "id": 3,
        "gridPos": {"h": 5, "w": 6, "x": 12, "y": 0},
        "type": "stat",
        "title": "BTCB/USDT Price",
        "targets": [
          {
            "datasource": "PostgreSQL",
            "rawSql": "SELECT price_btcb_usdt FROM bsc_pool_metrics ORDER BY timestamp DESC LIMIT 1",
            "format": "table"
          }
        ],
        "fieldConfig": {
          "defaults": {
            "unit": "currencyUSD",
            "decimals": 2,
            "thresholds": {
              "mode": "absolute",
              "steps": [
                {"color": "blue", "value": null}
              ]
            }
          }
        }
      },
      {
        "id": 4,
        "gridPos": {"h": 5, "w": 6, "x": 18, "y": 0},
        "type": "stat",
        "title": "Gini Coefficient",
        "description": "Token distribution inequality (lower = better)",
        "targets": [
          {
            "datasource": "PostgreSQL",
            "rawSql": "SELECT gini_coefficient FROM token_distribution ORDER BY timestamp DESC LIMIT 1",
            "format": "table"
          }
        ],
        "fieldConfig": {
          "defaults": {
            "unit": "percentunit",
            "decimals": 3,
            "thresholds": {
              "mode": "absolute",
              "steps": [
                {"color": "green", "value": 0},
                {"color": "yellow", "value": 0.6},
                {"color": "orange", "value": 0.8},
                {"color": "red", "value": 0.9}
              ]
            },
            "min": 0,
            "max": 1
          }
        }
      },
      {
        "id": 5,
        "gridPos": {"h": 8, "w": 12, "x": 0, "y": 5},
        "type": "timeseries",
        "title": "TVL & Liquidity Trend",
        "targets": [
          {
            "datasource": "PostgreSQL",
            "rawSql": "SELECT timestamp as time, tvl, token0_reserve * 70000 as btcb_value, token1_reserve as usdt_value FROM bsc_pool_metrics WHERE timestamp > $__timeFrom() ORDER BY timestamp",
            "format": "time_series"
          }
        ],
        "fieldConfig": {
          "defaults": {
            "unit": "currencyUSD",
            "custom": {
              "lineInterpolation": "smooth",
              "lineWidth": 2,
              "fillOpacity": 10,
              "spanNulls": true
            }
          },
          "overrides": [
            {
              "matcher": {"id": "byName", "options": "tvl"},
              "properties": [
                {"id": "color", "value": {"mode": "fixed", "fixedColor": "green"}},
                {"id": "displayName", "value": "Total TVL"}
              ]
            }
          ]
        }
      },
      {
        "id": 6,
        "gridPos": {"h": 8, "w": 12, "x": 12, "y": 5},
        "type": "timeseries",
        "title": "Trading Volume & Unique Traders",
        "targets": [
          {
            "datasource": "PostgreSQL",
            "rawSql": "SELECT date_trunc('hour', timestamp) as time, SUM(value_usd) as volume, COUNT(DISTINCT trader_address) as unique_traders FROM bsc_trades WHERE timestamp > $__timeFrom() GROUP BY 1 ORDER BY 1",
            "format": "time_series"
          }
        ],
        "fieldConfig": {
          "defaults": {
            "custom": {
              "drawStyle": "bars",
              "lineInterpolation": "smooth"
            }
          },
          "overrides": [
            {
              "matcher": {"id": "byName", "options": "volume"},
              "properties": [
                {"id": "unit", "value": "currencyUSD"},
                {"id": "color", "value": {"mode": "fixed", "fixedColor": "blue"}}
              ]
            },
            {
              "matcher": {"id": "byName", "options": "unique_traders"},
              "properties": [
                {"id": "unit", "value": "short"},
                {"id": "custom.drawStyle", "value": "line"},
                {"id": "custom.axisPlacement", "value": "right"}
              ]
            }
          ]
        }
      },
      {
        "id": 7,
        "gridPos": {"h": 8, "w": 8, "x": 0, "y": 13},
        "type": "table",
        "title": "Top Traders by PnL",
        "targets": [
          {
            "datasource": "PostgreSQL",
            "rawSql": "SELECT wallet_address, total_trades, total_volume_usd, realized_pnl, win_rate FROM bsc_wallet_metrics WHERE total_trades > 5 ORDER BY realized_pnl DESC LIMIT 20",
            "format": "table"
          }
        ],
        "fieldConfig": {
          "overrides": [
            {
              "matcher": {"id": "byName", "options": "wallet_address"},
              "properties": [
                {"id": "custom.width", "value": 150},
                {"id": "links", "value": [
                  {
                    "title": "View on BscScan",
                    "url": "https://bscscan.com/address/${__value.raw}"
                  }
                ]}
              ]
            },
            {
              "matcher": {"id": "byName", "options": "total_volume_usd"},
              "properties": [
                {"id": "unit", "value": "currencyUSD"},
                {"id": "decimals", "value": 0}
              ]
            },
            {
              "matcher": {"id": "byName", "options": "realized_pnl"},
              "properties": [
                {"id": "unit", "value": "currencyUSD"},
                {"id": "decimals", "value": 2},
                {"id": "custom.displayMode", "value": "color-background"},
                {"id": "thresholds", "value": {
                  "mode": "absolute",
                  "steps": [
                    {"color": "red", "value": -1000},
                    {"color": "yellow", "value": 0},
                    {"color": "green", "value": 1000}
                  ]
                }}
              ]
            },
            {
              "matcher": {"id": "byName", "options": "win_rate"},
              "properties": [
                {"id": "unit", "value": "percent"},
                {"id": "decimals", "value": 1}
              ]
            }
          ]
        }
      },
      {
        "id": 8,
        "gridPos": {"h": 8, "w": 8, "x": 8, "y": 13},
        "type": "table",
        "title": "Wash Trading Suspects",
        "description": "Wallets detected with suspicious trading patterns",
        "targets": [
          {
            "datasource": "PostgreSQL",
            "rawSql": "SELECT wallet_address, suspicious_tx_count, circular_volume, detection_score, array_length(related_wallets, 1) as related_count FROM wash_trade_suspects ORDER BY detection_score DESC LIMIT 10",
            "format": "table"
          }
        ],
        "fieldConfig": {
          "overrides": [
            {
              "matcher": {"id": "byName", "options": "detection_score"},
              "properties": [
                {"id": "unit", "value": "percent"},
                {"id": "custom.displayMode", "value": "gradient-gauge"},
                {"id": "max", "value": 100},
                {"id": "thresholds", "value": {
                  "mode": "absolute",
                  "steps": [
                    {"color": "green", "value": 0},
                    {"color": "yellow", "value": 50},
                    {"color": "red", "value": 75}
                  ]
                }}
              ]
            },
            {
              "matcher": {"id": "byName", "options": "circular_volume"},
              "properties": [
                {"id": "unit", "value": "currencyUSD"},
                {"id": "decimals", "value": 0}
              ]
            }
          ]
        }
      },
      {
        "id": 9,
        "gridPos": {"h": 8, "w": 8, "x": 16, "y": 13},
        "type": "piechart",
        "title": "Token Concentration",
        "targets": [
          {
            "datasource": "PostgreSQL",
            "rawSql": "SELECT 'Top 10' as metric, top_10_concentration as value FROM token_distribution ORDER BY timestamp DESC LIMIT 1 UNION ALL SELECT 'Top 11-50', top_50_concentration - top_10_concentration FROM token_distribution ORDER BY timestamp DESC LIMIT 1 UNION ALL SELECT 'Top 51-100', top_100_concentration - top_50_concentration FROM token_distribution ORDER BY timestamp DESC LIMIT 1 UNION ALL SELECT 'Others', 100 - top_100_concentration FROM token_distribution ORDER BY timestamp DESC LIMIT 1",
            "format": "table"
          }
        ],
        "options": {
          "pieType": "donut",
          "legend": {
            "displayMode": "table",
            "placement": "right",
            "values": ["percent", "value"]
          }
        },
        "fieldConfig": {
          "defaults": {
            "unit": "percent",
            "decimals": 2
          }
        }
      },
      {
        "id": 10,
        "gridPos": {"h": 8, "w": 12, "x": 0, "y": 21},
        "type": "timeseries",
        "title": "Buy vs Sell Pressure",
        "targets": [
          {
            "datasource": "PostgreSQL",
            "rawSql": "SELECT date_trunc('hour', timestamp) as time, SUM(CASE WHEN is_buy THEN value_usd ELSE 0 END) as buy_volume, SUM(CASE WHEN NOT is_buy THEN value_usd ELSE 0 END) as sell_volume FROM bsc_trades WHERE timestamp > $__timeFrom() GROUP BY 1 ORDER BY 1",
            "format": "time_series"
          }
        ],
        "fieldConfig": {
          "defaults": {
            "unit": "currencyUSD",
            "custom": {
              "fillOpacity": 50,
              "stacking": {"mode": "normal"}
            }
          },
          "overrides": [
            {
              "matcher": {"id": "byName", "options": "buy_volume"},
              "properties": [
                {"id": "color", "value": {"mode": "fixed", "fixedColor": "green"}}
              ]
            },
            {
              "matcher": {"id": "byName", "options": "sell_volume"},
              "properties": [
                {"id": "color", "value": {"mode": "fixed", "fixedColor": "red"}}
              ]
            }
          ]
        }
      },
      {
        "id": 11,
        "gridPos": {"h": 8, "w": 12, "x": 12, "y": 21},
        "type": "heatmap",
        "title": "Trading Activity Heatmap",
        "targets": [
          {
            "datasource": "PostgreSQL",
            "rawSql": "SELECT date_trunc('minute', timestamp) as time, CASE WHEN value_usd < 100 THEN '0-100' WHEN value_usd < 1000 THEN '100-1K' WHEN value_usd < 10000 THEN '1K-10K' ELSE '10K+' END as size_bucket, COUNT(*) as count FROM bsc_trades WHERE timestamp > $__timeFrom() GROUP BY 1, 2",
            "format": "time_series"
          }
        ],
        "options": {
          "calculate": false,
          "cellGap": 1,
          "color": {
            "scheme": "Spectral"
          }
        }
      },
      {
        "id": 12,
        "gridPos": {"h": 6, "w": 8, "x": 0, "y": 29},
        "type": "gauge",
        "title": "Pool Health Score",
        "description": "Composite score based on multiple factors",
        "targets": [
          {
            "datasource": "PostgreSQL",
            "rawSql": "WITH metrics AS (SELECT (CASE WHEN ABS(pool_ratio - 0.5) < 0.1 THEN 25 ELSE 0 END) + (CASE WHEN gini_coefficient < 0.7 THEN 25 ELSE 0 END) + (CASE WHEN unique_holders > 100 THEN 25 ELSE 0 END) + (SELECT 25 * (1 - COUNT(*)::float / 10) FROM wash_trade_suspects) as score FROM bsc_pool_metrics, token_distribution WHERE bsc_pool_metrics.timestamp = (SELECT MAX(timestamp) FROM bsc_pool_metrics) AND token_distribution.timestamp = (SELECT MAX(timestamp) FROM token_distribution)) SELECT score FROM metrics",
            "format": "table"
          }
        ],
        "fieldConfig": {
          "defaults": {
            "unit": "percent",
            "min": 0,
            "max": 100,
            "thresholds": {
              "mode": "absolute",
              "steps": [
                {"color": "red", "value": 0},
                {"color": "orange", "value": 25},
                {"color": "yellow", "value": 50},
                {"color": "light-green", "value": 75},
                {"color": "green", "value": 90}
              ]
            }
          }
        }
      },
      {
        "id": 13,
        "gridPos": {"h": 6, "w": 8, "x": 8, "y": 29},
        "type": "stat",
        "title": "Average Slippage",
        "description": "Price impact for typical trades",
        "targets": [
          {
            "datasource": "PostgreSQL",
            "rawSql": "SELECT AVG(slippage) * 100 as value FROM bsc_trades WHERE timestamp > NOW() - INTERVAL '1 hour' AND slippage IS NOT NULL",
            "format": "table"
          }
        ],
        "fieldConfig": {
          "defaults": {
            "unit": "percent",
            "decimals": 3,
            "thresholds": {
              "mode": "absolute",
              "steps": [
                {"color": "green", "value": 0},
                {"color": "yellow", "value": 0.5},
                {"color": "orange", "value": 1},
                {"color": "red", "value": 2}
              ]
            }
          }
        }
      },
      {
        "id": 14,
        "gridPos": {"h": 6, "w": 8, "x": 16, "y": 29},
        "type": "stat",
        "title": "New Holders (24h)",
        "targets": [
          {
            "datasource": "PostgreSQL",
            "rawSql": "SELECT COUNT(DISTINCT trader_address) FROM bsc_trades WHERE timestamp > NOW() - INTERVAL '24 hours' AND trader_address NOT IN (SELECT DISTINCT trader_address FROM bsc_trades WHERE timestamp < NOW() - INTERVAL '24 hours')",
            "format": "table"
          }
        ],
        "fieldConfig": {
          "defaults": {
            "unit": "short",
            "thresholds": {
              "mode": "absolute",
              "steps": [
                {"color": "red", "value": 0},
                {"color": "yellow", "value": 5},
                {"color": "green", "value": 10}
              ]
            }
          }
        },
        "options": {
          "graphMode": "area",
          "textMode": "value_and_name"
        }
      }
    ]
  },
  "overwrite": true
}