{
  "dashboard": {
    "id": null,
    "uid": "dex-analytics",
    "title": "DEX Onchain Analytics",
    "tags": ["dex", "blockchain", "trading"],
    "timezone": "browser",
    "schemaVersion": 30,
    "version": 1,
    "refresh": "5s",
    "time": {
      "from": "now-3h",
      "to": "now"
    },
    "panels": [
      {
        "id": 1,
        "gridPos": {"h": 4, "w": 6, "x": 0, "y": 0},
        "type": "stat",
        "title": "Total Volume (24h)",
        "targets": [
          {
            "datasource": "PostgreSQL",
            "rawSql": "SELECT SUM(value_usd) as value FROM dex_trades WHERE timestamp > NOW() - INTERVAL '24 hours'",
            "format": "table"
          }
        ],
        "fieldConfig": {
          "defaults": {
            "unit": "currencyUSD",
            "decimals": 0,
            "thresholds": {
              "mode": "absolute",
              "steps": [
                {"color": "green", "value": null},
                {"color": "red", "value": 1000000}
              ]
            }
          }
        }
      },
      {
        "id": 2,
        "gridPos": {"h": 4, "w": 6, "x": 6, "y": 0},
        "type": "stat",
        "title": "Total Trades (24h)",
        "targets": [
          {
            "datasource": "PostgreSQL",
            "rawSql": "SELECT COUNT(*) as value FROM dex_trades WHERE timestamp > NOW() - INTERVAL '24 hours'",
            "format": "table"
          }
        ],
        "fieldConfig": {
          "defaults": {
            "unit": "short",
            "decimals": 0,
            "thresholds": {
              "mode": "absolute",
              "steps": [
                {"color": "blue", "value": null}
              ]
            }
          }
        }
      },
      {
        "id": 3,
        "gridPos": {"h": 4, "w": 6, "x": 12, "y": 0},
        "type": "stat",
        "title": "Unique Traders (24h)",
        "targets": [
          {
            "datasource": "PostgreSQL",
            "rawSql": "SELECT COUNT(DISTINCT trader_address) as value FROM dex_trades WHERE timestamp > NOW() - INTERVAL '24 hours'",
            "format": "table"
          }
        ],
        "fieldConfig": {
          "defaults": {
            "unit": "short",
            "decimals": 0,
            "thresholds": {
              "mode": "absolute",
              "steps": [
                {"color": "purple", "value": null}
              ]
            }
          }
        }
      },
      {
        "id": 4,
        "gridPos": {"h": 4, "w": 6, "x": 18, "y": 0},
        "type": "stat",
        "title": "Avg Trade Size",
        "targets": [
          {
            "datasource": "PostgreSQL",
            "rawSql": "SELECT AVG(value_usd) as value FROM dex_trades WHERE timestamp > NOW() - INTERVAL '1 hour'",
            "format": "table"
          }
        ],
        "fieldConfig": {
          "defaults": {
            "unit": "currencyUSD",
            "decimals": 2,
            "thresholds": {
              "mode": "absolute",
              "steps": [
                {"color": "yellow", "value": null}
              ]
            }
          }
        }
      },
      {
        "id": 5,
        "gridPos": {"h": 8, "w": 12, "x": 0, "y": 4},
        "type": "timeseries",
        "title": "Trading Volume by DEX",
        "targets": [
          {
            "datasource": "PostgreSQL",
            "rawSql": "SELECT timestamp, dex_name, value_usd FROM dex_trades WHERE timestamp > NOW() - INTERVAL '3 hours' ORDER BY timestamp",
            "format": "time_series"
          }
        ],
        "fieldConfig": {
          "defaults": {
            "unit": "currencyUSD",
            "custom": {
              "lineInterpolation": "smooth",
              "lineWidth": 2,
              "fillOpacity": 10
            }
          }
        },
        "options": {
          "legend": {
            "displayMode": "list",
            "placement": "bottom"
          }
        }
      },
      {
        "id": 6,
        "gridPos": {"h": 8, "w": 12, "x": 12, "y": 4},
        "type": "timeseries",
        "title": "Token Prices",
        "targets": [
          {
            "datasource": "PostgreSQL",
            "rawSql": "SELECT timestamp, token_symbol, price_usd FROM token_prices WHERE timestamp > NOW() - INTERVAL '3 hours' AND token_symbol IN ('ETH', 'BTC', 'BNB', 'MATIC') ORDER BY timestamp",
            "format": "time_series"
          }
        ],
        "fieldConfig": {
          "defaults": {
            "unit": "currencyUSD",
            "custom": {
              "lineInterpolation": "smooth",
              "lineWidth": 2
            }
          }
        }
      },
      {
        "id": 7,
        "gridPos": {"h": 8, "w": 8, "x": 0, "y": 12},
        "type": "piechart",
        "title": "Volume by Chain",
        "targets": [
          {
            "datasource": "PostgreSQL",
            "rawSql": "SELECT chain_name as metric, SUM(value_usd) as value FROM dex_trades WHERE timestamp > NOW() - INTERVAL '24 hours' GROUP BY chain_name",
            "format": "table"
          }
        ],
        "options": {
          "legend": {
            "displayMode": "table",
            "placement": "right"
          },
          "pieType": "donut"
        }
      },
      {
        "id": 8,
        "gridPos": {"h": 8, "w": 8, "x": 8, "y": 12},
        "type": "piechart",
        "title": "Volume by DEX",
        "targets": [
          {
            "datasource": "PostgreSQL",
            "rawSql": "SELECT dex_name as metric, SUM(value_usd) as value FROM dex_trades WHERE timestamp > NOW() - INTERVAL '24 hours' GROUP BY dex_name",
            "format": "table"
          }
        ],
        "options": {
          "legend": {
            "displayMode": "table",
            "placement": "right"
          },
          "pieType": "pie"
        }
      },
      {
        "id": 9,
        "gridPos": {"h": 8, "w": 8, "x": 16, "y": 12},
        "type": "bargauge",
        "title": "Top Trading Pairs (24h)",
        "targets": [
          {
            "datasource": "PostgreSQL",
            "rawSql": "SELECT pair as metric, SUM(value_usd) as value FROM dex_trades WHERE timestamp > NOW() - INTERVAL '24 hours' GROUP BY pair ORDER BY value DESC LIMIT 10",
            "format": "table"
          }
        ],
        "options": {
          "orientation": "horizontal",
          "displayMode": "gradient",
          "showUnfilled": true
        },
        "fieldConfig": {
          "defaults": {
            "unit": "currencyUSD",
            "thresholds": {
              "mode": "absolute",
              "steps": [
                {"color": "green", "value": 0},
                {"color": "yellow", "value": 100000},
                {"color": "red", "value": 1000000}
              ]
            }
          }
        }
      },
      {
        "id": 10,
        "gridPos": {"h": 8, "w": 24, "x": 0, "y": 20},
        "type": "table",
        "title": "Recent Large Trades",
        "targets": [
          {
            "datasource": "PostgreSQL",
            "rawSql": "SELECT timestamp, chain_name, dex_name, pair, token_in, token_out, amount_in, amount_out, value_usd, trader_address FROM dex_trades WHERE value_usd > 10000 ORDER BY timestamp DESC LIMIT 20",
            "format": "table"
          }
        ],
        "options": {
          "showHeader": true
        },
        "fieldConfig": {
          "overrides": [
            {
              "matcher": {"id": "byName", "options": "value_usd"},
              "properties": [
                {"id": "unit", "value": "currencyUSD"},
                {"id": "decimals", "value": 2}
              ]
            },
            {
              "matcher": {"id": "byName", "options": "amount_in"},
              "properties": [{"id": "decimals", "value": 4}]
            },
            {
              "matcher": {"id": "byName", "options": "amount_out"},
              "properties": [{"id": "decimals", "value": 4}]
            }
          ]
        }
      },
      {
        "id": 11,
        "gridPos": {"h": 8, "w": 12, "x": 0, "y": 28},
        "type": "heatmap",
        "title": "Trading Activity Heatmap",
        "targets": [
          {
            "datasource": "PostgreSQL",
            "rawSql": "SELECT date_trunc('minute', timestamp) as time, dex_name, COUNT(*) as value FROM dex_trades WHERE timestamp > NOW() - INTERVAL '1 hour' GROUP BY time, dex_name ORDER BY time",
            "format": "time_series"
          }
        ],
        "options": {
          "calculate": false,
          "cellGap": 1,
          "color": {
            "scheme": "Spectral"
          }
        }
      },
      {
        "id": 12,
        "gridPos": {"h": 8, "w": 12, "x": 12, "y": 28},
        "type": "timeseries",
        "title": "Gas Usage Trend",
        "targets": [
          {
            "datasource": "PostgreSQL",
            "rawSql": "SELECT timestamp, chain_name, AVG(gas_used) OVER (PARTITION BY chain_name ORDER BY timestamp ROWS BETWEEN 10 PRECEDING AND CURRENT ROW) as gas_used FROM dex_trades WHERE timestamp > NOW() - INTERVAL '1 hour'",
            "format": "time_series"
          }
        ],
        "fieldConfig": {
          "defaults": {
            "unit": "short",
            "custom": {
              "lineInterpolation": "smooth",
              "lineWidth": 2
            }
          }
        }
      }
    ]
  },
  "overwrite": true
}